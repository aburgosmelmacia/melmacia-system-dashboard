version: '3'
services:
  devcontainer:
    image: mcr.microsoft.com/devcontainers/python:1-3.12
    volumes:
      - .:/workspaces/melmacia-system-dashboard:cached
      - ./.ssh:/tmp/.ssh:ro
    command: sleep infinity
    # Ejecuta el comando post-creaciÃ³n
    entrypoint: >
      /bin/sh -c "
        sudo -u vscode mkdir -p /home/vscode/.ssh &&
        sudo -u vscode cp -r /tmp/.ssh/* /home/vscode/.ssh/ &&
        sudo chown -R vscode:vscode /home/vscode/.ssh &&
        sudo chmod 700 /home/vscode/.ssh &&
        sudo chmod 600 /home/vscode/.ssh/* &&
        pip3 install -r requirements.txt &&
        python dashboard.py & python background_service.py & wait
      "
    working_dir: /workspaces/melmacia-system-dashboard
    ports:
      - "9000:9000"
    user: ${HOST_UID:-1000}:${HOST_GID:-1000}